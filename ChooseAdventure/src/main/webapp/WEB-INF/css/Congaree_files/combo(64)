YUI.add("hermes-template-account-menu-card-get-pro-button",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,t,l){var s,r=null!=e?e:{};return(null!=(s=n.if.call(r,null!=e?e.canPurchase:e,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.noop,data:l}))?s:"")+(null!=(s=n.if.call(r,null!=e?e.canResubscribe:e,{name:"if",hash:{},fn:a.program(4,l,0),inverse:a.noop,data:l}))?s:"")},2:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.GETPRO"},data:l}))+"</a>\n\t</div>\n"},4:function(a,e,n,t,l){return'\t<div class="upgrade">\n\t\t<a href="/account/upgrade/pro" data-action="follow" class="small butt">'+a.escapeExpression((n.intlMessage||e&&e.intlMessage||n.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"account-menu.RESUBSCRIBE_TO_PRO"},data:l}))+"</a>\n\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(a,e,n,t,l){var s;return null!=(s=n.unless.call(null!=e?e:{},null!=e?e.isOneTimePro:e,{name:"unless",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?s:""},useData:!0}),t={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(t[e]=n)}),a.Template.register("hermes/account-menu-card-get-pro-button",function(e,l){return l=l||{},l.partials=l.partials?a.merge(t,l.partials):t,n(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-subscriptions-changePlan-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-subscriptions-changePlan-updater"]={run:function(n,c){return c.callAPI("flickr.subscriptions.changePlan",n).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-braintree-close-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-braintree-close-deletor"]={run:function(l,c){return c.callAPI("flickr.subscriptions.braintree.close",l).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("subscription-history-list-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(r,this.appContext)}},attributes:{subscriptions:{isListProxy:!0},oneTimePro:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher"]});YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";function s(e){return{account_id:e.id}}require("hermes-core/flog")(t);e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(i,r){var n=this,a=s(i);return e.Promise.all([r.callAPI("flickr.subscriptions.braintree.getCustomerDetails",a,!0),r.getModelRegistry("subscription-history-list-models"),r.getModelRegistry("subscription-history-models")]).then(function(e){return n._processResponse(e,i,r)},e.PromiseCatcher(t))},_processParams:s,_processResponse:function(t,s,i){var r,n=t[0],a=t[1],o=t[2],c={};(r=n.customerDetails.subscriptions)&&r instanceof Array&&(c.subscriptions=r.map(function(t){var s={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),s.startDate=1e3*t.startDate,s.billingScheduleMonths=t.billingScheduleMonths,s.nextBillingDate=1e3*t.nextBillingDate,s.effectiveEndDate=1e3*t.effectiveEndDate,s.type=t.type,s.paymentMethodId=t.paymentMethodId,s.status=t.status,s.amountBilled=t.amountBilled,s.transactions=t.transactions,s.prettyName=t.planInfo.prettyName,s.prettyNameDuration=t.planInfo.prettyNameDuration,s.pendingPrice=t.pendingPrice||void 0,s.paymentVendorType=t.paymentVendorType||void 0,e.Array.each(s.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),o.exists(t.id)?(o.setValues(t.id,s),o.proxy(t.id)):(s.id=t.id,o.add(s))}),n.customerDetails.paymentHistory&&(c.oneTimePro=n.customerDetails.paymentHistory.proStatus)),a.exists(s.id)?a.setValues(s.id,c):(c.id=s.id,a.add(c))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["subscription-history-models","subscription-history-list-models"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}var r=new t.SubscriptionsHelper;t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{},paymentVendorType:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:r.getPaymentVendorType("braintree")}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-subscriptions-changePlan-updater","flickr-braintree-close-deletor","subscriptions-helper"]});