YUI.add("hermes-template-head-meta",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,r){return'name="'},3:function(e,a,n,t,r){return'property="'},5:function(e,a,n,t,r){return'description="'+e.escapeExpression(e.lambda(a,a))+'"'},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,r){var l,i,m,s=null!=a?a:{},o=n.helperMissing,p=e.escapeExpression,u="<meta "+(null!=(l=n.if.call(s,null!=a?a.isName:a,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r}))?l:"")+p("function"==typeof(i=null!=(i=n.metaName||(null!=a?a.metaName:a))?i:o)?i.call(s,{name:"metaName",hash:{},data:r}):i)+'" content="'+p((n.renderMetaInfo||a&&a.renderMetaInfo||o).call(s,null!=a?a.metaValue:a,{name:"renderMetaInfo",hash:{},data:r}))+'" ';return i=null!=(i=n.metaDescription||(null!=a?a.metaDescription:a))?i:o,m={name:"metaDescription",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r},l="function"==typeof i?i.call(s,m):i,n.metaDescription||(l=n.blockHelperMissing.call(a,l,m)),null!=l&&(u+=l),u+' data-dynamic="true">\n'},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/head-meta",function(a,r){return r=r||{},r.partials=r.partials?e.merge(t,r.partials):t,n(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-simplified-pro-hello-pro",function(a,e){var s=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,e,s,l,t){var n,i=null!=e?e:{},r=s.helperMissing,h=a.escapeExpression;return"<h1>"+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.HELLO_PRO"},data:t}))+"</h1>\n<p>"+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.GET_STARTED_WITH_SUPERPOWERS"},data:t}))+'</p>\n\n<ul>\n\t<li class="freebrowsing"><span></span><a href="/">'+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.BROWSE_AD_FREE"},data:t}))+'</a></li>\n\t<li class="auto-uploadr"><span></span><a href="/tools">'+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.GET_AUTO_UPLOADR"},data:t}))+'</a></li>\n\t<li class="partners"><span></span><a href="/account">'+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.VIEW_PARTNER_PERKS"},data:t}))+"</a></li>\n</ul>\n<p>"+h((s.intlMessage||e&&e.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"checkout.SHARE_YOUR_NEW_ADFREE_PHOTOSTREAM"},data:t}))+'</p>\n<p><a href="'+h("function"==typeof(n=null!=(n=s.photostreamURL||(null!=e?e.photostreamURL:e))?n:r)?n.call(i,{name:"photostreamURL",hash:{},data:t}):n)+'">'+h("function"==typeof(n=null!=(n=s.photostreamURL||(null!=e?e.photostreamURL:e))?n:r)?n.call(i,{name:"photostreamURL",hash:{},data:t}):n)+"</a></p>\n"},useData:!0}),l={};a.Array.each([],function(e){var s=a.Template.get("hermes/"+e);s&&(l[e]=s)}),a.Template.register("hermes/simplified-pro-hello-pro",function(e,t){return t=t||{},t.partials=t.partials?a.merge(l,t.partials):l,s(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("jsonp",function(e,t){function r(){this._init.apply(this,arguments)}var n=e.Lang.isFunction;r.prototype={_init:function(t,r){this.url=t,this._requests={},this._timeouts={},r=n(r)?{on:{success:r}}:r||{};var i=r.on||{};i.success||(i.success=this._defaultCallback(t,r)),this._config=e.merge({context:this,args:[],format:this._format,allowCache:!1},r,{on:i})},_defaultCallback:function(){},send:function(){function u(e,r){return n(e)?function(n){var o=!0,u="_requests";r?(++t._timeouts[s],--t._requests[s]):(t._requests[s]||(o=!1,u="_timeouts"),--t[u][s]),!t._requests[s]&&!t._timeouts[s]&&delete YUI.Env.JSONP[s],o&&e.apply(i.context,[n].concat(i.args))}:null}var t=this,r=e.Array(arguments,0,!0),i=t._config,s=t._proxy||e.guid(),o;return i.allowCache&&(t._proxy=s),t._requests[s]===undefined&&(t._requests[s]=0),t._timeouts[s]===undefined&&(t._timeouts[s]=0),t._requests[s]++,r.unshift(t.url,"YUI.Env.JSONP."+s),o=i.format.apply(t,r),i.on.success?(YUI.Env.JSONP[s]=u(i.on.success),e.Get.js(o,{onFailure:u(i.on.failure),onTimeout:u(i.on.timeout,!0),timeout:i.timeout,charset:i.charset,attributes:i.attributes,async:i.async}).execute(),t):t},_format:function(e,t){return e.replace(/\{callback\}/,t)}},e.JSONPRequest=r,e.jsonp=function(t,n){var r=new e.JSONPRequest(t,n);return r.send.apply(r,e.Array(arguments,2,!0))},YUI.Env.JSONP||(YUI.Env.JSONP={})},"3.16.0",{requires:["get","oop"]});
YUI.add("digital-river-helper",function(e){"use strict";var i=require("superagent"),t=require("superagent-jsonp"),r=require("url-parse");e.DigitalRiverHelper=function(i){this.appContext=i.appContext||!1,this.storeBaseURL=e.config.flickr.digitalRiver.storeBaseUrl,this.proLandingPageUrl="/account/upgrade/pro"},e.DigitalRiverHelper.prototype.getAnalyticsBeaconsPrefix=function(){return"[DR] "},e.DigitalRiverHelper.prototype.getClientSideSessionToken=function(){var t=e.config.flickr.digitalRiver.clientSessionTokenUrl;return e.Cookie.remove("JSESSIONID",{path:"/",domain:e.config.flickr.digitalRiver.storeBaseUrl}),e.Cookie.remove("VISITOR_ID",{path:"/",domain:e.config.flickr.digitalRiver.storeBaseUrl}),i.get(t).then(function(e){return e.body.session_token}.bind(this)).catch(function(e){return e})},e.DigitalRiverHelper.prototype.getClientSideSessionTokenJSONP=function(){var r=e.config.flickr.digitalRiver.clientSessionTokenUrl,n=e.config.flickr.digitalRiver.logoutUrl;return i.get(n).use(t({timeout:1e4,callbackName:"drLogout"+(new Date).getTime()})).then(function(e){return i.get(r).use(t({timeout:1e4,callbackName:"drSessionToken"+(new Date).getTime()})).then(function(e){return e.body.session_token})})},e.DigitalRiverHelper.prototype.getAPISessionRedirectUrl=function(i){return i=this.setDREnv(i),e.config.flickr.digitalRiver.userManagementPageBaseUrl+"APISessionRedirect?url="+encodeURIComponent(i)},e.DigitalRiverHelper.prototype.createCartAndGetStoreURL=function(i){return this.appContext.callAPI("flickr.digital.river.subscriptions.addProductToCart",i).then(function(t){if(t&&t.redirectUrl){var r=t.redirectUrl+"&currency="+i.currency+"&fproUrl="+i.fProUrl;return this.sanitizeRedirectUrl(r)}return e.url(this.proLandingPageUrl)}.bind(this)).catch(function(e){throw e})},e.DigitalRiverHelper.prototype.initializeSessionOnDR=function(e){return this.appContext.callAPI("flickr.digital.river.subscriptions.initializeSession",e).then(function(e){return!0}.bind(this)).catch(function(e){throw e})},e.DigitalRiverHelper.prototype.sanitizeRedirectUrl=function(i){var t=new r(i);if("https:"===t.protocol&&t.hostname===this.storeBaseURL){return this.setDREnv(i)}return console.log("checkout url validation failed"),e.url("/account")},e.DigitalRiverHelper.prototype.getRedirectUrlToUpdatePaymentMethod=function(i,t){var r=e.config.flickr.digitalRiver.userManagementPageBaseUrl+t+"/DisplayUpdateAddressPaymentInfoPage/";return i.getValue("isPaypal")?r+="?subscriptionID="+i.getValue("details").paymentVendorSubscriptionId:r+="?billingOptionID="+i.getValue("details").paymentVendorCreditCardToken,this.getAPISessionRedirectUrl(r)},e.DigitalRiverHelper.prototype.setDREnv=function(e){return this.appContext.flipper.isFlipped("enable-digital-river-design-env")?e+="&ENV=DESIGN":e},e.DigitalRiverHelper.prototype.getRedirectUrlToInvoicePage=function(i,t){i=i||"";var r=e.config.flickr.digitalRiver.userManagementPageBaseUrl+t+"/DisplayInvoicePage/?requisitionID="+i;return this.getAPISessionRedirectUrl(r)},e.DigitalRiverHelper.prototype.beaconError=function(i,t){if(!YUI.Env.isServer&&e.config.win.beaconError){var r={UA:("undefined"!=typeof navigator&&navigator.userAgent||"").toString(),signedIn:1,message:i};t&&(r=e.merge(r,t)),e.config.win.beaconError("[digital-river] ",e.config.win.location.href,r)}}},"@VERSION@",{requires:["array-extras","jsonp","cookie"],optional:[],optionalRequires:["superagent"]});YUI.add("hermes-template-photo-limit-overlay",function(e,a){var l=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,l,t,i){var s;return'<div class="photo-limit-overlay '+e.escapeExpression("function"==typeof(s=null!=(s=l.additionalClasses||(null!=a?a.additionalClasses:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"additionalClasses",hash:{},data:i}):s)+'">\n\t<div class="panel-container">\n\t</div>\n</div>\n'},useData:!0}),t={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(t[a]=l)}),e.Template.register("hermes/photo-limit-overlay",function(a,i){return i=i||{},i.partials=i.partials?e.merge(t,i.partials):t,l(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-photo-limit-panel",function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,r){return" active"},3:function(n,e,t,a,r){return" hidden off-right"},5:function(n,e,t,a,r){return'<p class="sub-text">'+n.escapeExpression((t.preventOrphans||e&&e.preventOrphans||t.helperMissing).call(null!=e?e:{},null!=e?e.subText:e,{name:"preventOrphans",hash:{},data:r}))+"</p>"},compiler:[7,">= 4.0.0"],main:function(n,e,t,a,r){var l,s,p=null!=e?e:{},i=t.helperMissing,u=n.escapeExpression;return'<div class="panel'+(null!=(l=t.if.call(p,null!=e?e.initialActive:e,{name:"if",hash:{},fn:n.program(1,r,0),inverse:n.program(3,r,0),data:r}))?l:"")+'" data-panel-index="'+u("function"==typeof(s=null!=(s=t.panelIndex||(null!=e?e.panelIndex:e))?s:i)?s.call(p,{name:"panelIndex",hash:{},data:r}):s)+'">\n\t<div class="panel-content">\n\t\t<h2>'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.title:e,{name:"preventOrphans",hash:{},data:r}))+'</h2>\n\t\t<div class="description-container">\n\t\t\t'+u((t.renderTrustedMarkup||e&&e.renderTrustedMarkup||i).call(p,null!=e?e.description:e,{name:"renderTrustedMarkup",hash:{},data:r}))+'\n\t\t</div>\n\n\t\t<div class="button-container">\n\t\t\t<a href="/account/upgrade/pro?select" class="button accept-button pro-link">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.acceptButtonText:e,{name:"preventOrphans",hash:{},data:r}))+'</a>\n\t\t\t<button class="button unfluid decline-button">'+u((t.preventOrphans||e&&e.preventOrphans||i).call(p,null!=e?e.declineButtonText:e,{name:"preventOrphans",hash:{},data:r}))+"</button>\n\t\t</div>\n\n\t\t"+(null!=(l=t.if.call(p,null!=e?e.subText:e,{name:"if",hash:{},fn:n.program(5,r,0),inverse:n.noop,data:r}))?l:"")+"\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/photo-limit-panel",function(e,r){return r=r||{},r.partials=r.partials?n.merge(a,r.partials):a,t(e,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-limit-overlay-view",function(e,t){require("hermes-core/flog")(t);var i=require("hermes-core/analytics");e.namespace("Views")[this.name]=e.Base.create("photo-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{},initializer:function(e){this.params=e},loadState:function(){return e.Promise.resolve()},buildContainer:function(){var e=this.params.overlayClassList||[];this.setContainerWithTemplate("photo-limit-overlay",{additionalClasses:e.join(" ")})},activate:function(){var t=this,i=this.get("container");if(this.panelContainer=i.one(".panel-container"),this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name,!this.appContext.getCookie(this.dismissCookieName))return e.Promise.all([this.appContext.getModel("person-public-profile-models",this.appContext.getViewer().nsid).then(function(e){t.publicProfileModel=e}),this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e})]).then(function(){t.isLoaded=!0,t.fire("loaded")})},show:function(){var t,n,a,l,o,s=this,p=this.get("container"),r="",h=e.config.flickr.account.photo_limit,c=e.UserLimitsHelper.getARRCount(this.profileModel);this.appContext.getCookie(this.dismissCookieName)||(n=parseInt(this.publicProfileModel.getValue("totalViews")),a=parseInt(this.publicProfileModel.getValue("totalFaves")),l=parseInt(this.publicProfileModel.getValue("totalTags")),o=Math.max(c-h,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.RIGHT_NOW_PHOTOS_AT_RISK",count:o}))+"</p>",n>1&&a<=1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS",views:e.IntlNumber.format(n,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES",faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l<=1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1)}))+"</p>":n<=1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_TAGS",tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a<=1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n<=1&&a>1&&l>1?r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_FAVES_TAGS",faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>":n>1&&a>1&&l>1&&(r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.LIMIT_OVERLAY_STATS_DISAPPEAR_VIEWS_FAVES_TAGS",views:e.IntlNumber.format(n,this.appContext.lang,1),faves:e.IntlNumber.format(a,this.appContext.lang,1),tags:e.IntlNumber.format(l,this.appContext.lang,1)}))+"</p>"),r+="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.TAKE_MOMENT_TO_PROTECT_PHOTOS"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:0,title:this.intlMessage({intlName:"upload-blocking.PROTECT_THESE_PHOTOS"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.SAVE_YOUR_PHOTOS"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.MARK_PHOTOS_FOR_DELETION_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"}),initialActive:!0})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.UPGRADE_YOU_ALSO_GET"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:1,title:this.intlMessage({intlName:"upload-blocking.DID_YOU_KNOW_FLICKR_PRO"}),description:r,acceptButtonText:this.intlMessage({intlName:"refencing-announcement.UPGRADE_TO_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.CONTINUE_WITHOUT_SECURING_PHOTOS_B",count:o}),subText:this.intlMessage({intlName:"upload-blocking.CHOOSE_ABOVE_TO_CONTINUE"})})),r="<p>"+e.StringHelper.preventOrphans(this.intlMessage({intlName:"upload-blocking.FLICKR_PROS_LOVE_PHOTOGRAPHY"}))+"</p>",this.panelContainer.appendChild(this.templates("photo-limit-panel")({panelIndex:2,title:this.intlMessage({intlName:"upload-blocking.DONT_NEED_TO_BE_PROFESSIONAL"}),description:r,acceptButtonText:this.intlMessage({intlName:"upload-blocking.JOIN_FLICKR_PRO"}),declineButtonText:this.intlMessage({intlName:"upload-blocking.DONT_REMIND_AGAIN_B"})})),t=this.panelContainer.all(".panel"),p.addClass("unhidden"),setTimeout(function(){p.addClass("active")},50),this.panelCount=t?t.size():0,i&&i.tl(!0,"o","Photo Limit Overlay: Show"),this.registerEventHandler(p.delegate("click",function(e){s.handleAcceptClick(e)},".accept-button")),this.registerEventHandler(p.delegate("click",function(e){s.handleDeclineClick(e)},".decline-button")))},hide:function(){var t=this.get("container");t.removeClass("active"),setTimeout(function(){t.removeClass("unhidden"),e.fire("photoLimitOverlay:hidden")},1e3)},showPanel:function(e){var t,i=this.get("container"),n=i.all(".panel"),a=i.one(".panel.active");e<n.size()&&(a.addClass("off-left"),a.removeClass("active"),setTimeout(function(){a.addClass("hidden")},1e3),(t=n.item(e)).removeClass("hidden"),t.addClass("active"),setTimeout(function(){t.removeClass("off-right")},50))},handleAcceptClick:function(t){i&&i.tl(e.one(t.target).getDOMNode(),"o","Photo Limit Overlay: Accept",null,"navigate")},handleDeclineClick:function(t){var n=t.target.ancestor(".panel",!0),a=parseInt(n.getAttribute("data-panel-index"));if(a+1<this.panelCount)this.showPanel(a+1);else{var l=new Date;l.setTime(l.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:l,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:l,path:"/"}),i&&i.tl(!0,"o","Photo Limit Overlay: Decline"),this.hide()}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-limit-overlay","hermes-template-photo-limit-panel","person-public-profile-models","intl-number","user-limits-helper","string-helper"],langBundles:["upload-blocking","refencing-announcement"]});YUI.add("photostream-page-view",function(e,t){var i=require("hermes-core/flog")(t),o=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create("photostream-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"global-nav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-photostream-coverphoto-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-magic-tools-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["photostream"],dealbreaker:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,additionalViewClasses:["photostream"]},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"photo-limit-overlay-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,overlayClassList:["light","top-aligned"]}},initializer:function(e){return this.nsid=e.nsid,this.isOwner=e.isOwner,this.withPhotoId=e.withPhotoId,this.contextSuffix=e.contextSuffix,this.pageParams=e.pageParams,this.isRouting=!1,this.isTwitterbot=e.isTwitterbot,this.isHelloPro=e.isHelloPro,e.isViewingSelf=!!this.appContext.getViewer().signedIn&&this.nsid===this.appContext.getViewer().nsid,e.photostreamId=e.nsid,e.modelRegistryName="photostream-models",e.photoListConfig={parentName:"photolist-container",pageParams:e.pageParams,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:e.withPhotoId,contextSuffix:e.contextSuffix},e.photoListConfig.modelParams={registryName:"photostream-models",modelIdOrAttributes:e.nsid+"-"+e.contextSuffix,collectionAttributeName:"photoPageList",fetchParams:{}},e.photoListConfig.modelParams.fetchParams.orderBy="use_pref",e.photoListConfig.modelParams.fetchParams.viewAs="use_pref",e.photoListConfig.layout={targetRowHeight:320,targetRowHeightTolerance:.1,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:0,right:0,bottom:8,left:0},itemSpacing:{horizontal:4,vertical:4}},this.photoListConfig=e.photoListConfig,e.subnavConfig={selected:"photostream"},this.geo=e.geo,this},loadState:function(){var t=this,i={},o=[];return this.withPhotoId&&(i.withPhotoId=this.withPhotoId),o.push(this.appContext.getModel("photostream-models",this.nsid+"-"+this.contextSuffix,i).then(function(e){t.set("photostreamModel",e),YUI.Env.isServer||t.recalculateNominalPage(e)})),this.appContext.flipper.isFlipped("enable-photo-limit-overlay")&&this.appContext.getViewer().signedIn&&o.push(this.appContext.getModel("person-profile-models",this.nsid).then(function(e){t.profileModel=e})),e.Promise.all(o)},buildContainer:function(){return this.setContainerWithTemplate("photostream-page",{"fluid-header":this.subviews["fluid-photostream-coverphoto-view"]?this.subviews["fluid-photostream-coverphoto-view"].get("container"):"",isEmpty:!(this.isRouting||!this.get("photostreamModel"))&&0===parseInt(this.get("photostreamModel").getValue("totalItems"),10),isViewingSelf:this.nsid===this.appContext.getViewer().nsid,showPhotoLimitOverlay:this.appContext.flipper.isFlipped("enable-photo-limit-overlay")}),this},activate:function(){var t=this;this.get("container");return e.later(100,this,function(){e.use("photo-page-scrappy-view")}),this.nsid!==this.appContext.getViewer().nsid&&this.appContext.getViewCounter().recordPhotostreamView({photostreamOwnerId:this.nsid,referrer:this.appContext.getReferrer()}),this.isHelloPro?this.appContext.getModel("person-models",this.nsid).then(function(t){if(this.showHelloProModal(t),this.appContext.flipper.isFlipped("enable-digital-river")){var i=new e.DigitalRiverHelper({appContext:this.appContext});o.canUserSeeDigitalRiver(this.geo.countryCode)&&i.getAnalyticsBeaconsPrefix()}}.bind(this)):(this.limitOverlaySubview=this.subviews["photo-limit-overlay-view"],this.appContext.flipper.isFlipped("enable-photo-limit-overlay")&&e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext)&&this.limitOverlaySubview&&this.isOwner&&(this.limitOverlaySubview.isLoaded?this.setupLimitOverlay():this.limitOverlaySubview.on("loaded",function(){t.setupLimitOverlay()})),this)},onSubviewEvent:function(e,t){"photostream:filter"===t[0]&&this.appContext.flapp.navigate(window.location.href)},recalculateNominalPage:function(e){var t=0;1!==this.pageParams.page&&-1!==this.appContext.getLocation().href.search(/page[0-9]+/)&&(t=Math.ceil(e.getValue("totalItems")/this.pageParams.viewPageSize),this.pageParams.nominalPage>t&&(this.isRouting=!0,this.appContext.flapp.navigate(this.appContext.getLocation().pathname.replace(/page[0-9]+/,""))))},buildHeadContainer:function(){var t,o,a,s,r=this.get("photostreamModel"),n=r?r.getValue("photoPageList").getList():[],l="summary",h=[];if(r&&(a=n.length?this.intlMessage({intlName:"meta.PHOTOSTREAM",username:r.getValue("owner").getValue("displayname"),photoCount:r.getValue("totalItems")}):this.intlMessage({intlName:"meta.PHOTOSTREAM_NO_PHOTOS",username:r.getValue("owner").getValue("displayname")})),this.isTwitterbot)if(0+n.length>=4)for(l="gallery",s=0;s<4;s++)n[s]&&n[s].getSizeToFit?h.push({property:"twitter:image"+s,content:n[s].getSizeToFit({width:640,height:640}).url}):i.error("error calling getSizeToFit.");else i.warn("not enough photos to create twitter gallery.");t=n.length>0&&n[0]?n[0].getSizeToFit(this.nsid,{width:640,height:640}):{},o=this.templates("dynamic-page-head")({title:r?r.getValue("owner").getValue("displayname"):null,description:a,url:r?r.getValue("url"):null,fullURL:r?e.url(r.getValue("url")):null,openGraphImageURL:t.url?e.URLHelper.addProtocolToURL(t.url):null,openGraphaImageWidth:t.width,openGraphaImageHeight:t.height,ownerURL:r?r.getValue("owner").getValue("url"):null,twitterCardType:l,twitterImages:h,flickrType:"photostream",openId:!0,domain:e.url(),feeds:r?[{title:this.intlMessage({intlName:"meta.PHOTOSTREAM_ATOM_TITLE",username:r.getValue("owner").getValue("displayname")}),url:"/services/feeds/photos_public.gne?id="+r.getValue("normalizedId")+"&lang="+this.appContext.lang.toLowerCase()+"&format=atom"}]:[]}),o+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",o):(this.set("headContainer",o.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},getTrackingSegments:function(){return{couldHaveSeenAd:!this.get("photostreamModel").getValue("owner").getValue("isPro")&&!this.appContext.getViewer().isPro,vwrOwner:this.isOwner?1:0}},showHelloProModal:function(t){var i=e.URLHelper.generatePersonUrls(t),o=new e.Views.FluidModal({actionButtonLabel:this.intlMessage({intlName:"checkout.OK_THANKS"}),htmlMessage:this.templates("simplified-pro-hello-pro")({photostreamURL:e.url(i.photostream)}),showBodyLines:!0,showHeader:!1,appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,actionButtonDisabled:!1,actionButtonIsDangerous:!1,showCancelButton:!1,hideModalOverlay:!1,classList:"welcome-pro-modal",showCancelX:!1});o.on("activated",function(t){var a=o.get("container").one(".freebrowsing"),s=o.get("container").one(".auto-uploadr"),r=o.get("container").one(".partners");a.on("click",function(t){e.config.win.location=e.url("/")}),s.on("click",function(t){e.config.win.location=e.url("/tools")}),r.on("click",function(t){e.config.win.location=e.url("/account")}),setTimeout(function(){e.config.win.history.replaceState({},"",i.photostream)},1e3)}),o.on("actionClick",function(t){e.config.win.location=e.url(i.photostream)}),o.show()},setupLimitOverlay:function(){var t=this.get("container");this.limitOverlaySubview.show(),this.photoListSubview=this.subviews["photo-list-view"],t.addClass("with-photo-limit-overlay"),setTimeout(function(){e.config.win.scrollTo(0,0)},200),this.registerEventHandler(e.on("photoLimitOverlay:hidden",function(){t.removeClass("with-photo-limit-overlay")}))}},{ATTRS:{spaceid:{value:792600537}}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","hermes-template-photostream-page","global-nav-view","footer-full-view","photo-list-view","pagination-view","person-models","fluid-photostream-coverphoto-view","fluid-magic-subnav-view","fluid-modal-view","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-simplified-pro-hello-pro","url-helper","digital-river-helper","subscriptions-helper","storage-helper","photo-limit-overlay-view"],optional:["photostream-models"],langBundles:["header","common","meta","checkout","magic-empty-states","filter-bar"]});